generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum PaymentMethod {
  bank
  e_wallet
  credit_card
}

enum PaymentStatus {
  belum
  lunas
}

enum NotificationType {
  payment_success
  payment_error
  payment_pending
}

enum UserRole {
  admin
  mahasiswa
}

model User {
  id                     BigInt         @id @default(autoincrement())
  name                   String
  email                  String         @unique
  password               String
  role                   UserRole       @default(admin)
  foto                   String?       
  rememberToken          String?        @map("remember_token")
  createdAt              DateTime       @default(now()) @map("created_at")
  updatedAt              DateTime       @updatedAt @map("updated_at")

  @@map("users")
}

model Mahasiswa {
  id                     BigInt         @id @default(autoincrement())
  name                   String
  email                  String         @unique
  password               String
  nim                    Int            @unique
  kelas                  String
  phone                  String
  semester               Int            @default(1)
  jurusanId              BigInt         @map("jurusan_id")
  foto                   String?
  createdAt              DateTime       @default(now()) @map("created_at")
  updatedAt              DateTime       @updatedAt @map("updated_at")

  jurusan                Jurusan        @relation(fields: [jurusanId], references: [id], onDelete: Restrict)
  payments               Payment[]
  notifications          Notification[]

  @@index([jurusanId])
  @@map("mahasiswas")
}

model Payment {
  id                     BigInt         @id @default(autoincrement())
  mahasiswaId            BigInt         @map("mahasiswa_id")
  paymentCode            String         @unique @map("payment_code")
  semester               Int            @default(1)
  biayaPokok             Decimal?       @db.Decimal(12, 2) @map("biaya_pokok")
  biayaTambahanJurusan   Decimal?       @db.Decimal(12, 2) @map("biaya_tambahan_jurusan")
  biayaPraktikum         Decimal?       @db.Decimal(12, 2) @map("biaya_praktikum")
  biayaUjian             Decimal?       @db.Decimal(12, 2) @map("biaya_ujian")
  biayaKegiatan          Decimal?       @db.Decimal(12, 2) @map("biaya_kegiatan")
  totalPayment           Decimal?       @db.Decimal(12, 2) @map("total_payment")
  paymentMethod          PaymentMethod  @map("payment_method")
  status                 PaymentStatus  @default(belum)
  
  // Midtrans fields
  midtransOrderId        String?        @map("midtrans_order_id")
  midtransTransactionId  String?        @map("midtrans_transaction_id")
  midtransPaymentUrl     String?        @map("midtrans_payment_url")
  midtransVaNumber       String?        @map("midtrans_va_number")
  midtransBillKey        String?        @map("midtrans_bill_key")
  midtransBillerCode     String?        @map("midtrans_biller_code")
  
  createdAt              DateTime       @default(now()) @map("created_at")
  updatedAt              DateTime       @updatedAt @map("updated_at")

  mahasiswa              Mahasiswa      @relation(fields: [mahasiswaId], references: [id], onDelete: Cascade)

  @@index([mahasiswaId])
  @@index([midtransOrderId])
  @@map("payments")
}

model Campus {
  id                     BigInt         @id @default(autoincrement())
  name                   String         @unique
  address                String?
  foto                   String?
  createdAt              DateTime       @default(now()) @map("created_at")
  updatedAt              DateTime       @updatedAt @map("updated_at")

  fakultas               Fakultas[]

  @@map("campuses")
}

model Fakultas {
  id                     BigInt         @id @default(autoincrement())
  name                   String
  campusId               BigInt         @map("campus_id")
  createdAt              DateTime       @default(now()) @map("created_at")
  updatedAt              DateTime       @updatedAt @map("updated_at")

  campus                 Campus         @relation(fields: [campusId], references: [id], onDelete: Cascade)
  jurusan                Jurusan[]

  @@index([campusId])
  @@map("fakultas")
}

model Jurusan {
  id                     BigInt         @id @default(autoincrement())
  name                   String
  fakultasId             BigInt         @map("fakultas_id")
  createdAt              DateTime       @default(now()) @map("created_at")
  updatedAt              DateTime       @updatedAt @map("updated_at")

  fakultas               Fakultas       @relation(fields: [fakultasId], references: [id], onDelete: Cascade)
  mahasiswa              Mahasiswa[]
  biayaDefaults          BiayaDefault[]

  @@index([fakultasId])
  @@map("jurusan")
}

model BiayaDefault {
  id                     BigInt         @id @default(autoincrement())
  jurusanId              BigInt         @map("jurusan_id")
  semester               Int            @default(1)
  biayaPokok             Decimal?       @db.Decimal(12, 2) @map("biaya_pokok")
  biayaTambahanJurusan   Decimal?       @db.Decimal(12, 2) @map("biaya_tambahan_jurusan")
  biayaPraktikum         Decimal?       @db.Decimal(12, 2) @map("biaya_praktikum")
  biayaUjian             Decimal?       @db.Decimal(12, 2) @map("biaya_ujian")
  biayaKegiatan          Decimal?       @db.Decimal(12, 2) @map("biaya_kegiatan")
  createdAt              DateTime       @default(now()) @map("created_at")
  updatedAt              DateTime       @updatedAt @map("updated_at")

  jurusan                Jurusan        @relation(fields: [jurusanId], references: [id], onDelete: Cascade)

  @@unique([jurusanId, semester])
  @@map("biaya_defaults")
}

model Notification {
  id                     BigInt           @id @default(autoincrement())
  mahasiswaId            BigInt           @map("mahasiswa_id")
  type                   NotificationType
  title                  String
  message                String
  icon                   String?          @default("default")
  isRead                 Boolean          @default(false) @map("is_read")
  createdAt              DateTime         @default(now()) @map("created_at")
  updatedAt              DateTime         @updatedAt @map("updated_at")

  mahasiswa              Mahasiswa        @relation(fields: [mahasiswaId], references: [id], onDelete: Cascade)

  @@index([mahasiswaId])
  @@index([isRead])
  @@index([createdAt])
  @@map("notifications")
}
